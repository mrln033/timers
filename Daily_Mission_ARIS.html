<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mission Daily => A.R.I.S.</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 40px;
}

table {
  border-collapse: collapse;
  width: 550px;
}

th, td {
  border: 1px solid #ccc;
  padding: 12px;
}

th {
  background: #f2f2f2;
  text-align: left;
}

.timer-cell {
  display: flex;
  align-items: center;
  gap: 15px;
  font-size: 1.2rem;
}

input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.time {
  font-family: monospace;
  font-size: 1.3rem;
}
</style>
</head>

<body>

<h2>-= Mission Daily => A.R.I.S. =-</h2>

<table>
<thead>
<tr>
<th>Nom de Mission</th>
<th>Temps Restant</th>
</tr>
</thead>
<tbody id="timers-body">
</tbody>
</table>

<script>

/* ========= JSON INTÉGRÉ ========= */

const timersConfig = [
  { "id": "24h",     "name": "Timer 24h",       "hours": 24 },
  { "id": "8h",      "name": "Timer 8h",        "hours": 8 },
  { "id": "36h",     "name": "Timer 36h",       "hours": 36 },
  { "id": "24h-bis", "name": "Timer 24h (bis)", "hours": 24 }
];

/* ========= VARIABLES ========= */

const intervals = {};
const tableBody = document.getElementById("timers-body");

/* ========= FORMATAGE ========= */

function formatTime(ms) {
  const totalSeconds = Math.max(0, Math.floor(ms / 1000));
  const h = String(Math.floor(totalSeconds / 3600)).padStart(2, "0");
  const m = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, "0");
  const s = String(totalSeconds % 60).padStart(2, "0");
  return `${h}:${m}:${s}`;
}

/* ========= CRÉATION DU TABLEAU ========= */

function createTimerRow(timer) {

  const durationMs = timer.hours * 60 * 60 * 1000;

  const tr = document.createElement("tr");

  tr.innerHTML = `
    <td>${timer.name}</td>
    <td class="timer-cell">
      <input type="checkbox" id="chk-${timer.id}">
      <span class="time" id="time-${timer.id}">${formatTime(durationMs)}</span>
    </td>
  `;

  tableBody.appendChild(tr);

  const checkbox = document.getElementById(`chk-${timer.id}`);
  const timeEl = document.getElementById(`time-${timer.id}`);

  /* ====== INITIALISATION ====== */

  const endTime = Number(localStorage.getItem(`endTime_${timer.id}`));
  const running = localStorage.getItem(`running_${timer.id}`) === "true";

  if (running && endTime && endTime > Date.now()) {

    checkbox.checked = true;
    runInterval(timer, durationMs, endTime);

  } else {

    timeEl.textContent = formatTime(durationMs);
    checkbox.checked = false;

  }

  /* ====== EVENT ====== */

  checkbox.addEventListener("change", () => {
    if (checkbox.checked) {
      startTimer(timer, durationMs);
    } else {
      stopTimer(timer);
    }
  });

}

/* ========= DÉMARRAGE ========= */

function startTimer(timer, durationMs) {

  const endTime = Date.now() + durationMs;

  localStorage.setItem(`endTime_${timer.id}`, endTime);
  localStorage.setItem(`running_${timer.id}`, "true");

  runInterval(timer, durationMs, endTime);
}

/* ========= ARRÊT ========= */

function stopTimer(timer) {
  clearInterval(intervals[timer.id]);
  localStorage.setItem(`running_${timer.id}`, "false");
}

/* ========= INTERVAL ========= */

function runInterval(timer, durationMs, endTime) {

  const timeEl = document.getElementById(`time-${timer.id}`);
  const checkbox = document.getElementById(`chk-${timer.id}`);

  clearInterval(intervals[timer.id]);

  intervals[timer.id] = setInterval(() => {

    const remaining = endTime - Date.now();
    timeEl.textContent = formatTime(remaining);

    if (remaining <= 0) {
      clearInterval(intervals[timer.id]);
      checkbox.checked = false;
      localStorage.setItem(`running_${timer.id}`, "false");
      localStorage.removeItem(`endTime_${timer.id}`);
      timeEl.textContent = formatTime(durationMs);
    }

  }, 1000);
}

/* ========= INITIALISATION GLOBALE ========= */

timersConfig.forEach(timer => createTimerRow(timer));

</script>

</body>
</html>
